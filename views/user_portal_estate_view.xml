<odoo>
    <template id="user_portal_estate_view" name="All Estate Properties">
        <t t-call="portal.portal_layout">
            <t t-set="title">Available Estate Properties</t>

            <div class="container o_portal_my_doc_table">
                <h2>All Properties</h2>

                <div class="row">
                    <!-- LEFT FILTERS -->
                    <div class="col-md-3">
                        <form id="filter_form" action="/my/estate-available" method="get">
                            <h5>Filters</h5>

                            <!-- Property Type -->
                            <div class="mb-3">
                                <label for="type">Type</label>
                                <select name="type" id="type_filter" class="form-control">
                                    <option value="">All</option>
                                    <t t-foreach="property_types" t-as="type">
                                        <option t-att-value="type.name" t-att-selected="type.name == selected_type">
                                        <t t-esc="type.name"/>
                                        </option>
                                    </t>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="max_price">Max. Price</label>
                                <input type="number" name="max_price" id="max_price" class="form-control" t-att-value="selected_max_price or ''"/>
                            </div>
                            <div class="mb-3">
                                <label for="living_area">Min. Living Area</label>
                                <input type="number" name="min_living_area" id="min_living_area" class="form-control" t-att-value="selected_min_living_area or ''"/>
                            </div>
                            <div class="mb-3 form-check">
                                <input type="checkbox" name="favorites_only" id="favorites_only" class="form-check-input" t-att-checked="favorites_only"/>
                                <label for="favorites_only" class="form-check-label">Show Favorites Only</label>
                            </div>                         
                            <div class="mb-3">
                                <button type="button" class="btn btn-primary" id="reset_filters">Reset Filter</button>
         
                            </div>       
                            
                        </form>
                    </div>

                    <!-- RIGHT PROPERTY LIST -->
                    <div id="property_table_container" class="col-md-9">
                        <table class="table table-hover table-striped">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th class="sortable" data-sort-key="name" style="cursor:pointer;">Name</th>
                                    <th class="sortable" data-sort-key="property_type" style="cursor:pointer;">Type</th>
                                    <th class="sortable" data-sort-key="postcode" style="cursor:pointer;">Postcode</th>
                                    <th class="sortable" data-sort-key="address" style="cursor:pointer;">Address</th>
                                    <th class="sortable" data-sort-key="living_area" style="cursor:pointer;">Living Area</th>
                                    <th class="sortable" data-sort-key="expected_price" style="cursor:pointer;">Expected Price</th>
                                    <th class="sortable" data-sort-key="my_offer" style="cursor:pointer;">My Offer</th>
                                    <th class="sortable" data-sort-key="date_availability" style="cursor:pointer;">Availability</th>
                                    <th class="sortable" data-sort-key="state" style="cursor:pointer;">Status</th>
                                    <th>Favorite</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="properties" t-as="prop">
                                    <tr t-att-data-href="'/my/estate/%d' % prop.id" class="clickable-row" style="cursor:pointer;">
                                        <t t-set="icon" t-value="'/account/static/src/img/castle.jpg'" />
                                        <td>
                                            <img t-att-src="icon" alt="Castle" style="width:100%; max-width:40px; height:auto;" />
                                        </td>
                                        <td><t t-esc="prop.name"/></td>
                                        <td><t t-esc="prop.property_type_id.name or ''"/></td>
                                        <td><t t-esc="prop.postcode or ''"/></td>
                                        <td><t t-esc="prop.address or ''"/></td>
                                        <td><t t-esc="prop.living_area or 0"/> mÂ²</td>
                                        <td><t t-esc="prop.expected_price or 0.0"/> $</td>
                                        <td>
                                            <t t-set="my_offer" t-value="0.0"/>
                                            <t t-foreach="prop.property_offer_ids" t-as="offer">
                                                <t t-if="offer.partner_id.id == request.env.user.partner_id.id">
                                                    <t t-if="offer.price &gt; my_offer">
                                                        <t t-set="my_offer" t-value="offer.price"/>
                                                    </t>
                                                </t>
                                            </t>
                                            <t t-if="my_offer">
                                                <t t-esc="my_offer"/> $
                                            </t>
                                        </td>
                                        <td><t t-esc="prop.date_availability"/></td>
                                        <td><t t-esc="prop.state"/></td>
                                        <td>
                                            <label style="cursor:pointer;">
                                                <input type="checkbox" class="favorite-checkbox d-none" t-att-data-id="prop.id" />
                                                <t t-set="is_favorite" t-value="prop in partner.favorite_property_ids"/>
                                                <span
                                                    class="favorite-star"
                                                    t-att-class="is_favorite and 'favorite-star active-star' or 'favorite-star'"
                                                    t-att-data-id="prop.id"
                                                    t-attf-style="font-size: 2.5rem; color: #{'gold' if is_favorite else 'gray'};"
                                                >
                                                    <t t-raw="is_favorite and '&#9733;' or '&#9734;'"/>
                                                </span>
                                            </label>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
        </t>
    </template>
</odoo>
